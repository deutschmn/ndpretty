---

title: Implementation


keywords: fastai
sidebar: home_sidebar



nb_path: "00_ndpretty.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 00_ndpretty.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Some static definitions of the colour scale and the number format.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And the core implementation:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ndarray_html" class="doc_header"><code>ndarray_html</code><a href="https://github.com/deutschmn/ndpretty/tree/master/ndpretty/core.py#L25" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ndarray_html</code>(<strong><code>a</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Example-usages">Example usages<a class="anchor-link" href="#Example-usages"> </a></h2><p>A numeric 2D array:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ndarray_html</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">10</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A numeric 1D array:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ndarray_html</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">10</span><span class="p">,)))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A numeric 4D array:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ndarray_html</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When an ndarray has more than two dimensions, a text field (an <a href="https://ipywidgets.readthedocs.io">ipywidget</a>) is depicted on top of the table, where the user can slice down the array to have two dimension, so that it can be displayed in a table.</p>
<p><em>Note: The <code>ipywidget</code> that is used for multi-dimensional arrays is not correctly rendered in the documentation. Therefore see this screenshot:</em></p>
<p>{% include image.html height="80px" file="/ndpretty/img/4D.png" %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A string array:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ndarray_html</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="s1">&#39;nd&#39;</span><span class="p">,</span> <span class="s1">&#39;pretty&#39;</span><span class="p">,</span> <span class="s1">&#39;ndpretty&#39;</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A bool array:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ndarray_html</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Automatic-default-slicing">Automatic default slicing<a class="anchor-link" href="#Automatic-default-slicing"> </a></h3><p>When an array would generally be too huge to display, it is automatically downsliced to the value of <a href="/ndpretty/ndpretty.html#default_max_dim_size"><code>default_max_dim_size</code></a>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;default_max_dim_size is </span><span class="si">{</span><span class="n">default_max_dim_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">ndarray_html</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>default_max_dim_size is 200
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Registering-formatters-for-IPython">Registering formatters for IPython<a class="anchor-link" href="#Registering-formatters-for-IPython"> </a></h2><p>We don't always want to call <a href="/ndpretty/ndpretty.html#ndarray_html"><code>ndarray_html</code></a> to show our nice table. In order to make it the default formatter for cell return values, here are some helper functions to automatically register the formatters.</p>
<p>This makes use of <a href="https://ipython.readthedocs.io/en/stable/config/integrating.html?highlight=third%20party#formatters-for-third-party-types">IPyhton third-party formatters</a>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="register_formatter" class="doc_header"><code>register_formatter</code><a href="https://github.com/deutschmn/ndpretty/tree/master/ndpretty/core.py#L105" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>register_formatter</code>(<strong><code>dtype</code></strong>, <strong><code>html_formatter</code></strong>, <strong><code>print_formatter</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="for-ndarray">for <code>ndarray</code><a class="anchor-link" href="#for-ndarray"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ndarray_stats_print_formatter" class="doc_header"><code>ndarray_stats_print_formatter</code><a href="https://github.com/deutschmn/ndpretty/tree/master/ndpretty/core.py#L113" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ndarray_stats_print_formatter</code>(<strong><code>x</code></strong>, <strong><code>_</code></strong>, <strong><code>__</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="no_print_formatter" class="doc_header"><code>no_print_formatter</code><a href="https://github.com/deutschmn/ndpretty/tree/master/ndpretty/core.py#L116" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>no_print_formatter</code>(<strong><code>x</code></strong>, <strong><code>_</code></strong>, <strong><code>__</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="register_ndarray_formatter" class="doc_header"><code>register_ndarray_formatter</code><a href="https://github.com/deutschmn/ndpretty/tree/master/ndpretty/core.py#L119" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>register_ndarray_formatter</code>(<strong><code>print_formatter</code></strong>=<em><code>ndarray_stats_print_formatter</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A formatter can be registered like this:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">register_ndarray_formatter</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>From then onwards, all returned ndarrays are formatted using ndpretty.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>2×8 float64 ndarray
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre></pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="for-torch.Tensor">for <code>torch.Tensor</code><a class="anchor-link" href="#for-torch.Tensor"> </a></h3><p>We also define a default formatter for PyTorch <code>Tensor</code>s:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="torch_tensor_html" class="doc_header"><code>torch_tensor_html</code><a href="https://github.com/deutschmn/ndpretty/tree/master/ndpretty/core.py#L123" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>torch_tensor_html</code>(<strong><code>t</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="tensor_stats_print_formatter" class="doc_header"><code>tensor_stats_print_formatter</code><a href="https://github.com/deutschmn/ndpretty/tree/master/ndpretty/core.py#L126" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>tensor_stats_print_formatter</code>(<strong><code>x</code></strong>, <strong><code>_</code></strong>, <strong><code>__</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="register_torch_tensor_formatter" class="doc_header"><code>register_torch_tensor_formatter</code><a href="https://github.com/deutschmn/ndpretty/tree/master/ndpretty/core.py#L129" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>register_torch_tensor_formatter</code>(<strong><code>print_formatter</code></strong>=<em><code>tensor_stats_print_formatter</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="s1">&#39;torch&#39;</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
    <span class="n">register_torch_tensor_formatter</span><span class="p">()</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">t</span> <span class="o">=</span> <span class="s1">&#39;torch not imported&#39;</span>
<span class="n">t</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;torch not imported&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Default-configuration-for-convenience">Default configuration for convenience<a class="anchor-link" href="#Default-configuration-for-convenience"> </a></h3><p>Finally we define a convenience function to quickly initialise the default configuration where both ndarrays and PyTorch tensors are formatted.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="default" class="doc_header"><code>default</code><a href="https://github.com/deutschmn/ndpretty/tree/master/ndpretty/core.py#L133" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>default</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">default</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>
<h3 id="TODOs-and-potential-new-features">TODOs and potential new features<a class="anchor-link" href="#TODOs-and-potential-new-features"> </a></h3><ul>
<li>[x] zero-dim arrays</li>
<li>[x] strings</li>
<li>[x] ints</li>
<li>[x] bools</li>
<li>[x] size limit: if array is larger than certain size, do auto-slicing</li>
<li>[ ] slider for decimal places or text field for format</li>
<li>[ ] fallback in case of exception</li>
<li>[ ] unregister hook</li>
<li>[ ] check if in IPython and don't crash otherwise</li>
</ul>

</div>
</div>
</div>
</div>
 

